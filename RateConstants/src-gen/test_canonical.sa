semantic adaptation reactive moore RateConstants rateConstants
at "./RateConstants.fmu"

	for inner fmu Constants constants
		at "./Constants.fmu"
		with output ports Real psuvolt, Real ref
	
output ports Real psuvolt , Real
			ref param Integer 	RATE := 10 , Real INIT_PSUVOLT := 0.0 , Real INIT_REF := 0.0 ;

control rules {
	var Real micro_step := 0.0;
	var Real inner_time := 0.0;
	
	inner_time := t;
	
	micro_step := H/RATE;
	
	for (var iter in 0 .. RATE) {
		do_step(constants,inner_time,micro_step);
		inner_time := inner_time + micro_step;	
	}
	
	return H;
}

in rules {
true -> { } --> { } ; }
out var Real stored__ref := INIT_REF , Real stored__psuvolt := INIT_PSUVOLT ; out rules {
true -> {
stored__psuvolt := constants . psuvolt ;
stored__ref := constants . ref ; } --> {
rateConstants . psuvolt := stored__psuvolt ;
rateConstants . ref := stored__ref ; } ; }